<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulario de Registro</title>
</head>

<body>
  <h1>Formulario de Registro</h1>
  <form id="userForm">
    <label for="name">Nombre:</label>
    <input type="text" id="name" name="name" required><br><br>

    <label for="email">Correo:</label>
    <input type="email" id="email" name="email" required><br><br>

    <label for="phone">Teléfono (Colombia):</label>
    <input type="tel" id="phone" name="phone" maxlength="10" required><br><br>

    <label>
      <input type="checkbox" id="terms" name="terms" required>
      Acepto los <a href="#">términos y condiciones</a> y las <a href="#">políticas de tratamiento de datos</a>.
    </label><br><br>

    <button type="submit">Enviar</button>
  </form>

  <script type="text/javascript">
    document.getElementById('name').addEventListener('input', function (e) {
      const nameInput = e.target;
      // Eliminar cualquier carácter que no sea una letra o espacio en blanco
      nameInput.value = nameInput.value.replace(/[^a-zA-Z\s]/g, '');
    });

    document.getElementById('phone').addEventListener('input', function (e) {
      const phoneInput = e.target;
      // Eliminar cualquier carácter que no sea un número
      phoneInput.value = phoneInput.value.replace(/\D/g, '');

      // Limitar el número de dígitos a 10
      if (phoneInput.value.length > 10) {
        phoneInput.value = phoneInput.value.slice(0, 10);
      }

      // Asegurarse de que el número comience con 3
      if (phoneInput.value.length > 0 && phoneInput.value[0] !== '3') {
        alert("El número debe comenzar con un 3.");
        phoneInput.value = '';
      }
    });

    document.getElementById('userForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      try {
        // Recoger los datos del formulario
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const phone = document.getElementById('phone').value;

        // Verificar si los términos y condiciones han sido aceptados
        const terms = document.getElementById('terms').checked;
        if (!terms) {
          alert("Debes aceptar los términos y condiciones.");
          return;
        }

        // Verificar que el nombre no esté vacío y contenga solo letras y espacios
        const nameRegex = /^[a-zA-Z\s]+$/;
        if (!nameRegex.test(name) || name.trim() === '') {
          alert("Por favor, ingrese un nombre válido (solo letras y espacios en blanco).");
          return;
        }

        // Verificar que el número de teléfono tenga 10 dígitos y comience con 3
        if (phone.length !== 10 || phone[0] !== '3') {
          alert("Por favor, ingrese un número de teléfono válido de Colombia (debe comenzar con 3 y contener 10 dígitos).");
          return;
        }

        // Obtener la fecha y hora actual
        const now = new Date();
        const timestamp = now.toLocaleString(); // Formato legible
        console.log("timestamp", timestamp);

        // Enviar los datos a Google Sheets
        const data = {
          name: name,
          email: email,
          phone: phone,
          timestamp: timestamp
        };

        const response = await fetch('https://script.google.com/macros/s/AKfycby-erffz_Uys3TLS7DHMJ6d2sVh1aNklZKWTVdilm43MuHUKSL2j2lBrUZbGbI7fQGs/exec', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          mode: 'no-cors',
          body: JSON.stringify(data),
        });

        console.log("response", response);

        // Verifica si la respuesta fue exitosa
        if (response.ok) {
          const result = await response.json();
          console.log("result", result);
          if (result.result === 'success') {
            alert("Datos enviados exitosamente!");
          } else {
            console.error('Error en el servidor:', result.message || 'Error desconocido');
            alert("Error en el servidor.");
          }
        } else {
          console.error('Error en la respuesta HTTP:', response.statusText);
          alert("Error al enviar los datos.");
        }

      } catch (error) {
        console.error('Error al enviar los datos:', error);
        alert("Error al enviar los datos.");
      } finally {
        // Limpiar el formulario
        document.getElementById('userForm').reset();
      }
    });


  </script>
</body>

</html>